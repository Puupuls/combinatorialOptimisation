<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        svg{
            width: 90vw;
            height: 90vh;
        }
    </style>
</head>
<body>
<span id="cost"></span>
<svg
        id="graph"
        xmlns="http://www.w3.org/2000/svg"
>
    <defs>
        <marker
                id="triangle"
                viewBox="0 0 10 10"
                refX="20"
                refY="5"
                markerUnits="strokeWidth"
                markerWidth="10"
                markerHeight="10"
                orient="auto">
            <path d="M 0 0 L 10 5 L 0 10 z" fill="#000" />
        </marker>
    </defs>
</svg>
<script>
    const SCALE = 50
    const domain = JSON.parse(`{{ domain | tojson }}`);
    const graph = document.getElementById('graph')

    if(domain.solutions.length > 0){
        let solution = domain.solutions[domain.solutions.length - 1]
        renderSolution(solution, domain)
    }
    renderDomain(domain)

    function renderDomain(domain) {
        let xMin = Math.min(...domain.points.map(p => p.x))
        let xMax = Math.max(...domain.points.map(p => p.x))
        let yMin = Math.min(...domain.points.map(p => p.y))
        let yMax = Math.max(...domain.points.map(p => p.y))
        let width = xMax - xMin;
        let height = yMax - yMin;
        graph.setAttribute("viewBox", `${(xMin - width * 0.1) * SCALE} ${(yMin - height * 0.1) * SCALE} ${(width * 1.2) * SCALE} ${(height * 1.2) * SCALE}`)

        for (let idx in domain.points) {
            let p = domain.points[idx]
            let circle = document.createElement("circle");
            circle.setAttribute("r", 0.2 * SCALE);
            circle.setAttribute("cx", p.x * SCALE);
            circle.setAttribute("cy", p.y * SCALE);
            circle.setAttribute("stroke", "black");
            graph.appendChild(circle)


            let idxText = document.createElement("text")
            idxText.setAttribute("fill", "white")
            idxText.innerText = idx
            idxText.setAttribute("font-size", 0.35 * SCALE)
            graph.appendChild(idxText)
            idxText.setAttribute("x", p.x * SCALE - 0.35 * SCALE / 4)
            idxText.setAttribute("y", p.y * SCALE + 0.35 * SCALE / 4)

            let coordText = document.createElement("text")
            coordText.innerText = `${p.x}, ${p.y} (${p.value})`
            coordText.setAttribute("fill", "gray")
            coordText.setAttribute("font-size", 0.2 * SCALE)
            graph.appendChild(coordText)
            coordText.setAttribute("x", p.x * SCALE - SCALE / 4)
            coordText.setAttribute("y", p.y * SCALE + 0.35 * SCALE)
        }
        graph.innerHTML += ""
    }

    function renderSolution(solution, domain){
        document.getElementById('cost').innerText = `Cost: ${solution.cost}`

        let links = solution.links
        let points = domain.points

        for(let idx in links){
            let startPoint = points[idx];
            for(let trgIdx in links[idx]){
                if(links[idx][trgIdx]>0) {
                    let endPoint = points[trgIdx];

                    let path = document.createElement('path')
                    let dirX = endPoint.x - startPoint.x
                    let dirY = endPoint.y - startPoint.y
                    path.setAttribute("d", `M ${ startPoint.x*SCALE} ${startPoint.y*SCALE} C ${ startPoint.x*SCALE - dirX * SCALE * 0.15} ${startPoint.y*SCALE + dirY * SCALE * 0.15}  ${ endPoint.x*SCALE} ${endPoint.y*SCALE} ${ endPoint.x*SCALE} ${endPoint.y*SCALE}`)
                    path.setAttribute('marker-end', "url(#triangle)")
                    path.setAttribute('stroke-width', 1)
                    path.setAttribute('stroke', links[idx][trgIdx] === 1? "red" : "green")
                    path.setAttribute('fill', "none")
                    graph.appendChild(path)
                }
            }
        }
        graph.innerHTML += ""
    }
</script>
</body>
</html>